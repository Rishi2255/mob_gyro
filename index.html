<!DOCTYPE html>
<html>
<head>
    <title>360 VR - High Performance</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-stereo-component@0.5.0/dist/aframe-stereo-component.min.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; }
        #ui { 
            position: absolute; z-index: 1000; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: #000; color: white; font-family: sans-serif;
        }
        button { 
            padding: 20px 40px; background: #4A4A4A; color: white; border: none; 
            border-radius: 12px; font-size: 18px; cursor: pointer; margin-top: 10px;
        }
        .hidden { display: none !important; }
        
        /* This ensures no curved masks or "boxes" appear */
        .a-enter-vr, .a-enter-ar { display: none !important; }
    </style>
</head>
<body>

    <div id="ui">
        <h1>360 VR Player</h1>
        <input type="file" id="fileInput" accept="video/*">
        <button id="startBtn" class="hidden">LAUNCH FULL VR 360</button>
    </div>

    <a-scene id="scene" vr-mode-ui="enabled: false" style="display:none">
        <a-assets>
            <video id="v" crossorigin="anonymous" playsinline webkit-playsinline loop></video>
        </a-assets>

        <a-entity camera look-controls stereo="eye: left"></a-entity>

        <a-videosphere src="#v" rotation="0 -90 0" 
                       material="repeat: 1 0.5; offset: 0 0.5" 
                       stereo="eye: left">
        </a-videosphere>

        <a-videosphere src="#v" rotation="0 -90 0" 
                       material="repeat: 1 0.5; offset: 0 0" 
                       stereo="eye: right">
        </a-videosphere>
    </a-scene>

    <script>
        const fileInput = document.getElementById('fileInput');
        const startBtn = document.getElementById('startBtn');
        const video = document.getElementById('v');
        const scene = document.getElementById('scene');
        const ui = document.getElementById('ui');

        fileInput.onchange = (e) => {
            if (e.target.files[0]) {
                video.src = URL.createObjectURL(e.target.files[0]);
                video.load();
                startBtn.classList.remove('hidden');
            }
        };

        startBtn.onclick = async () => {
            // 1. Permissions
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                await DeviceOrientationEvent.requestPermission();
            }

            // 2. Force Fullscreen (iOS specific)
            const doc = document.documentElement;
            if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
            else if (doc.requestFullscreen) doc.requestFullscreen();

            // 3. UI Toggle
            ui.style.display = 'none';
            scene.style.display = 'block';
            video.play();

            // 4. THE MAGIC: Force A-Frame's internal Stereo Dual-Screen
            // This renders the scene twice (one for each eye) in one engine
            setTimeout(() => {
                scene.enterVR();
            }, 200);
        };
    </script>
</body>
</html>
