<!DOCTYPE html>
<html>
<head>
    <title>360 VR - Perfect Alignment</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; touch-action: none; }
        
        #ui { 
            position: absolute; z-index: 1000; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: #000; color: white; font-family: sans-serif;
        }

        .viewport-container {
            display: none; 
            position: absolute; top: 0; left: 0; width: 100vw; height: 100vh;
            flex-direction: row;
            /* This gap can be adjusted to help eye alignment */
            gap: 0px; 
        }

        .eye {
            width: 50%; height: 100%; position: relative; overflow: hidden;
        }

        canvas { width: 100% !important; height: 100% !important; }

        button#startBtn { 
            padding: 20px 40px; background: #4A4A4A; color: white; border: none; 
            border-radius: 12px; font-size: 18px; cursor: pointer;
        }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="ui">
        <input type="file" id="fileInput" accept="video/*">
        <button id="startBtn" class="hidden">START DUAL SCREEN vr</button>
        <p style="font-size: 12px; color: #888; margin-top: 10px;">Hold phone sideways (Landscape)</p>
    </div>

    <div id="wrapper" class="viewport-container">
        <div class="eye">
            <a-scene embedded vr-mode-ui="enabled: false">
                <a-assets><video id="v" crossorigin="anonymous" playsinline webkit-playsinline loop></video></a-assets>
                <a-entity id="leftRig" position="-0.03 0 0">
                    <a-entity camera="fov: 80" look-controls></a-entity>
                </a-entity>
                <a-videosphere src="#v" rotation="0 -90 0" material="repeat: 1 0.5; offset: 0 0.5"></a-videosphere>
            </a-scene>
        </div>
        <div class="eye">
            <a-scene embedded vr-mode-ui="enabled: false">
                <a-entity id="rightRig" position="0.03 0 0">
                    <a-entity camera="fov: 80" look-controls="enabled: false"></a-entity>
                </a-entity>
                <a-videosphere src="#v" rotation="0 -90 0" material="repeat: 1 0.5; offset: 0 0"></a-videosphere>
            </a-scene>
        </div>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const startBtn = document.getElementById('startBtn');
        const video = document.getElementById('v');
        const ui = document.getElementById('ui');
        const wrapper = document.getElementById('wrapper');
        const leftScene = document.querySelectorAll('a-scene')[0];
        const rightScene = document.querySelectorAll('a-scene')[1];

        fileInput.onchange = (e) => {
            if (e.target.files[0]) {
                video.src = URL.createObjectURL(e.target.files[0]);
                video.load();
                startBtn.classList.remove('hidden');
            }
        };

        startBtn.onclick = async () => {
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                try { await DeviceOrientationEvent.requestPermission(); } catch (e) {}
            }

            ui.style.display = 'none';
            wrapper.style.display = 'flex';
            video.play();

            const leftCam = leftScene.querySelector('[camera]');
            const rightCam = rightScene.querySelector('[camera]');

            // SYNC CORE: Force the right eye to match the left eye's head movement
            leftScene.addEventListener('componentchanged', (evt) => {
                if (evt.detail.name === 'rotation') {
                    rightCam.setAttribute('rotation', evt.detail.newData);
                }
            });
        };
    </script>
</body>
</html>

