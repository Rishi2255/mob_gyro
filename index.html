<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Stereo VR Fix</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-stereo-component@0.5.0/dist/aframe-stereo-component.min.js"></script>
    <style>
      body { margin: 0; background: #111; color: white; font-family: sans-serif; }
      #overlay {
        position: absolute; z-index: 10; width: 100%; height: 100%;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        background: rgba(0,0,0,0.9);
      }
      .btn { padding: 15px 30px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; display: none; }
    </style>
  </head>
  <body>

    <div id="overlay">
      <h2>Stereoscopic 360 Player</h2>
      <input type="file" id="file-input" accept="video/*">
      <p id="status">Select a video file to begin</p>
      <button id="start-btn" class="btn">PLAY VIDEO</button>
    </div>

    <a-scene>
      <a-assets>
        <video id="stereo-video" crossorigin="anonymous" playsinline webkit-playsinline preload="auto"></video>
      </a-assets>

      <a-entity camera look-controls stereo-camera="eye:left"></a-entity>

      <a-videosphere src="#stereo-video" stereo="eye:left" material="shader: flat; npot: true"></a-videosphere>
      <a-videosphere src="#stereo-video" stereo="eye:right" material="shader: flat; npot: true"></a-videosphere>
    </a-scene>

    <script>
      const fileInput = document.getElementById('file-input');
      const video = document.getElementById('stereo-video');
      const startBtn = document.getElementById('start-btn');
      const status = document.getElementById('status');

      fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          status.innerText = "Processing file...";
          video.src = URL.createObjectURL(file);
          video.load();
          
          video.onloadedmetadata = () => {
            status.innerText = "Video Loaded (" + video.videoWidth + "x" + video.videoHeight + ")";
            startBtn.style.display = "block";
          };
        }
      });

      startBtn.addEventListener('click', () => {
        video.play();
        document.getElementById('overlay').style.display = 'none';
        
        // Force A-Frame to refresh textures
        const scene = document.querySelector('a-scene');
        scene.renderTarget = null; // Forces a re-render
      });
    </script>
  </body>
</html>
